{
  "edges": [
    {
      "from": "secrets-1",
      "to": "deliberation",
      "constant": true,
      "out": "API_KEY",
      "in": "API_KEY"
    },
    {
      "from": "secrets-1",
      "to": "handle-orders",
      "constant": true,
      "out": "CREATE_ORDER_URL",
      "in": "url"
    },
    {
      "from": "secrets-1",
      "to": "wait-for-printer",
      "constant": true,
      "out": "GET_ORDER_URL",
      "in": "url"
    },
    {
      "from": "secrets-1",
      "out": "_",
      "to": "no-order",
      "in": "_",
      "optional": true
    },
    {
      "from": "no-order",
      "out": "value",
      "to": "ask-user",
      "in": "_something"
    },
    {
      "from": "load-first-question",
      "out": "text",
      "to": "ask-user",
      "in": "message",
      "optional": true
    },
    {
      "from": "ask-user",
      "out": "text",
      "to": "deliberation-template",
      "in": "user"
    },
    {
      "from": "load-prompt",
      "out": "text",
      "to": "deliberation-template",
      "in": "context",
      "optional": true
    },
    {
      "from": "deliberation-template",
      "out": "prompt",
      "to": "conversation-history",
      "in": "context"
    },
    {
      "from": "deliberation-template",
      "out": "prompt",
      "to": "deliberation",
      "in": "text"
    },
    {
      "from": "handle-orders",
      "out": "success",
      "to": "no-order",
      "in": "value",
      "optional": true
    },
    {
      "from": "deliberation",
      "out": "completion",
      "to": "extract-json-moves",
      "in": "json"
    },
    {
      "from": "deliberation",
      "out": "completion",
      "to": "deliberation-template",
      "in": "agent"
    },
    {
      "from": "deliberation",
      "out": "completion",
      "to": "extract-json-order",
      "in": "json"
    },
    {
      "from": "deliberation",
      "out": "completion",
      "to": "extract-json-response",
      "in": "json"
    },
    {
      "from": "extract-json-moves",
      "out": "_",
      "to": "extract-json-response",
      "in": "_require-json-moves",
      "optional": true
    },
    {
      "from": "deliberation",
      "out": "completion",
      "to": "no-order",
      "in": "_trigger",
      "optional": true
    },
    {
      "from": "extract-json-order",
      "out": "result",
      "to": "handle-orders",
      "in": "body"
    },
    {
      "from": "extract-json-moves",
      "out": "moves",
      "to": "check-if-finished",
      "in": "texts"
    },
    {
      "from": "check-if-finished",
      "out": "result",
      "to": "handle-orders",
      "in": "_required"
    },
    {
      "from": "check-if-finished",
      "out": "result",
      "to": "no-move-found",
      "in": "value",
      "optional": true
    },
    {
      "from": "no-move-found",
      "out": "value",
      "to": "extract-json-response",
      "in": "_requires-no-move"
    },
    {
      "from": "extract-json-response",
      "out": "result",
      "to": "ask-user",
      "in": "message"
    },
    {
      "from": "handle-orders",
      "out": "response",
      "to": "extract-key-field",
      "in": "data"
    },
    {
      "from": "extract-key-field",
      "out": "value",
      "to": "wait-for-printer",
      "in": "key"
    },
    {
      "from": "conversation-history",
      "out": "context",
      "to": "deliberation-template",
      "in": "context",
      "optional": true
    }
  ],
  "nodes": [
    {
      "id": "no-order",
      "type": "not-logic"
    },
    {
      "id": "no-move-found",
      "type": "not-logic"
    },
    {
      "id": "load-first-question",
      "type": "text-asset",
      "configuration": {
        "filename": "seeds/coffee-bot/prompts/first-question.txt"
      }
    },
    {
      "id": "load-prompt",
      "type": "text-asset",
      "configuration": {
        "filename": "seeds/coffee-bot/prompts/coffee-prompt.txt"
      }
    },
    {
      "id": "ask-user",
      "type": "input",
      "configuration": {}
    },
    {
      "id": "deliberation-template",
      "type": "prompt-template",
      "configuration": {
        "agent": "",
        "template": "{{context}}\n{{agent}}\nCustomer: {{user}}\n"
      }
    },
    {
      "id": "secrets-1",
      "type": "secrets",
      "configuration": {
        "keys": ["API_KEY", "CREATE_ORDER_URL", "GET_ORDER_URL"]
      }
    },
    {
      "id": "deliberation",
      "type": "custom-text-completion",
      "configuration": {
        "HARM_CATEGORY_DEROGATORY": "BLOCK_MEDIUM_AND_ABOVE",
        "candidate_count": 8
      }
    },
    {
      "id": "extract-json-response",
      "type": "custom-jsonata",
      "configuration": {
        "expression": "response"
      }
    },
    {
      "id": "extract-json-order",
      "type": "custom-jsonata",
      "configuration": {
        "expression": "currentOrder"
      }
    },
    {
      "id": "extract-json-moves",
      "type": "custom-jsonata",
      "configuration": {
        "expression": "a"
      }
    },
    {
      "id": "extract-key-field",
      "type": "get-field",
      "configuration": {
        "field": "key"
      }
    },
    {
      "id": "handle-orders",
      "type": "api-call",
      "configuration": {
        "method": "POST",
        "headers": {
          "Content-Type": "application/json"
        }
      }
    },
    {
      "id": "check-if-finished",
      "type": "contains-str",
      "configuration": {
        "pattern": "finishOrder"
      }
    },
    {
      "id": "wait-for-printer",
      "type": "api-call",
      "configuration": {
        "method": "GET",
        "headers": {
          "Content-Type": "application/json"
        },
        "expected_value": null,
        "success_required": true,
        "num_retries": 5,
        "retry_delay_ms": 5000
      }
    },
    {
      "id": "conversation-history",
      "type": "local-memory"
    }
  ],
  "kits": [
    {
      "url": "npm:@google-labs/coffee-bot"
    },
    {
      "url": "npm:@google-labs/llm-starter"
    }
  ]
}
